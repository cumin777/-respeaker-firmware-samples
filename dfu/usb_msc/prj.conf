# USB MSC (flash-backed) using the "next" USB device stack
CONFIG_USB_DEVICE_STACK_NEXT=y
CONFIG_USBD_MSC_CLASS=y
CONFIG_USBD_MSC_LUNS_PER_INSTANCE=1

# Windows enumeration may issue control requests with large wLength (e.g. 4095).
# The UDC allocates net_bufs from this pool for EP0 transfers.
CONFIG_UDC_BUF_POOL_SIZE=8192

# Fix: the nRF UDC internal thread (udc_nrfx) default stack (512) is too small
# with logging/MSC enabled and can overflow during enumeration.
CONFIG_UDC_NRF_THREAD_STACK_SIZE=1536

# Logging: keep useful logs but avoid extra threads/buffers.
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MODE_IMMEDIATE=y

# Flash-disk block device
CONFIG_DISK_DRIVER_FLASH=y
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y

# External flash (nRF QSPI NOR)
CONFIG_NORDIC_QSPI_NOR=y

# File system (FAT) for post-copy scanning
CONFIG_FILE_SYSTEM=y
CONFIG_FAT_FILESYSTEM_ELM=y

# Allow FatFS to create a filesystem when none exists (we still control
# when formatting is allowed from the application using FS_MOUNT_FLAG_NO_FORMAT).
CONFIG_FS_FATFS_MOUNT_MKFS=y

# Reduce FatFS RAM usage
CONFIG_FS_FATFS_NUM_FILES=2
CONFIG_FS_FATFS_NUM_DIRS=2
CONFIG_FS_FATFS_LFN=n

# Button uses GPIO directly (saves DK library RAM)
CONFIG_GPIO=y

# Console/logging
CONFIG_SERIAL=y
CONFIG_STDOUT_CONSOLE=y
CONFIG_UART_LINE_CTRL=y
CONFIG_LOG=y
CONFIG_MAIN_STACK_SIZE=2048

# Reduce logging overhead
CONFIG_USBD_MSC_LOG_LEVEL_INF=y
CONFIG_DISK_LOG_LEVEL_INF=y
CONFIG_FLASHDISK_LOG_LEVEL_INF=y

# NOTE: Do not use CONFIG_SAMPLE_USBD_* here. Those symbols are only available
# in Zephyr's in-tree USB samples and will be undefined in applications.
